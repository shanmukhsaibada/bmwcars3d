<script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableZoom = true;
    controls.enablePan = false;

    const loader = new THREE.GLTFLoader();
    const urlParams = new URLSearchParams(window.location.search);
    const modelUrl = urlParams.get('model');

    loader.load(modelUrl, function (gltf) {
        const model = gltf.scene;

        // ✅ Slight squeeze vertically
        model.scale.set(1, 0.9, 1); 

        scene.add(model);

        // ✅ Auto-fit and move camera back
        const box = new THREE.Box3().setFromObject(model);
        const size = box.getSize(new THREE.Vector3()).length();
        const center = box.getCenter(new THREE.Vector3());

        controls.target.copy(center);

        const fitOffset = 1.4; // <-- increase to push car further back
        const maxDim = Math.max(box.getSize(new THREE.Vector3()).x, box.getSize(new THREE.Vector3()).y, box.getSize(new THREE.Vector3()).z);
        const fov = camera.fov * (Math.PI / 180);
        let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2)) * fitOffset;

        camera.position.set(center.x, center.y + maxDim / 8, center.z + cameraZ);
        camera.lookAt(center);
        camera.updateProjectionMatrix();

        // Lighting
        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
        scene.add(light);

        animate();
    });

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
